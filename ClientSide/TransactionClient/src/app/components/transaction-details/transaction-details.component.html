<div class="d-flex mt-4 ms-4">

    <div class="flex-grow-1 me-3">
        <div class="card shadow-sm">
            <div class="card-body">
                <h4 class="mb-3">Transaction List</h4>

                <div style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-striped table-hover rounded mb-0">
                        <thead class="table-light sticky-top">
                            <tr>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Actions</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr *ngFor="let tx of transactionDetails?.transactions; let i = index">
                                <ng-container *ngIf="editingIndex !== i; else editRow">
                                    <td>{{ tx.date | date: 'MM/dd/yyyy' }}</td>
                                    <td>{{ tx.category?.name }}</td>
                                    <td>{{ tx.description }}</td>
                                    <td>{{ tx.amount | currency }}</td>
                                    <td>
                                        <button mat-icon-button color="primary" (click)="editTransaction(i)">
                                            <mat-icon>edit</mat-icon>
                                        </button>
                                        <button mat-icon-button color="warn" (click)="deleteTransaction(i)">
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </td>
                                </ng-container>

                                <ng-template #editRow>
                                    <td>
                                        <input type="date" class="form-control form-control-sm" [(ngModel)]="editedTransaction!.date">
                                    </td>
                                    <td>
                                        <select class="form-select form-select-sm" [(ngModel)]="editedTransaction!.category">
                                            <option [ngValue]="null" disabled>Select Category</option>
                                            <option *ngFor="let cat of transactionDetails?.categoryList" [ngValue]="cat">{{ cat.name }}</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" [(ngModel)]="editedTransaction!.description">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control form-control-sm" [(ngModel)]="editedTransaction!.amount">
                                    </td>
                                    <td>
                                        <button mat-icon-button color="primary" (click)="saveEdit(i)">
                                            <mat-icon>save</mat-icon>
                                        </button>
                                        <button mat-icon-button (click)="cancelEdit()">
                                            <mat-icon>close</mat-icon>
                                        </button>
                                    </td>
                                </ng-template>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <table class="table table-striped table-hover rounded mt-0 mb-0">
                    <tfoot>
                        <tr>
                            <td>
                                <input type="date"
                                       class="form-control form-control-sm"
                                       [(ngModel)]="newTransaction.date">
                            </td>

                            <td>
                                <select class="form-select form-select-sm" [(ngModel)]="newTransaction.category">
                                    <option [ngValue]="null" disabled selected>Select Category</option>
                                    <option *ngFor="let cat of transactionDetails?.categoryList" [ngValue]="cat">
                                        {{ cat.name }}
                                    </option>
                                </select>

                            </td>

                            <td>
                                <input type="text"
                                       class="form-control form-control-sm"
                                       placeholder="Description"
                                       [(ngModel)]="newTransaction.description">
                            </td>

                            <td>
                                <input type="number"
                                       class="form-control form-control-sm"
                                       placeholder="Amount"
                                       [(ngModel)]="newTransaction.amount">
                            </td>

                            <td>
                                <button mat-icon-button color="primary" (click)="addTransaction()">
                                    <mat-icon>add</mat-icon>
                                </button>
                            </td>
                        </tr>
                    </tfoot>
                </table>

            </div>
        </div>
    </div>



    <div class="card shadow-sm position-sticky top-4"
         style="width: 250px; height: fit-content; border-right: none; border-left: 1px solid #dee2e6; border-top: 1px solid #dee2e6; border-bottom: 1px solid #dee2e6;">

        <div class="card-body">
            <h4 class="text-center mb-3">Summary</h4>

            <h5 class="card-title">Totals by Category</h5>

            <ul class="list-group list-group-flush mb-2">

                <li class="list-group-item d-flex justify-content-between"
                    *ngFor="let cat of transactionDetails?.categoryList">
                    <span>{{ cat.name }}</span>
                    <span>{{ cat.totalAmount | currency }}</span>
                </li>

            </ul>

            <hr>

            <div class="d-flex justify-content-between fw-bold">
                <span>Gross Total</span>
                <span>{{ transactionDetails?.transactionTotalAmount | currency }}</span>
            </div>

            <hr>

            <div>
                <p class="mb-1">
                    <strong># of Transactions:</strong>
                    {{ transactionDetails?.numOfTransactions }}
                </p>

                <p class="mb-1">
                    <strong>Average Transaction:</strong>
                    {{ transactionDetails?.averageTransactionAmount | currency }}
                </p>
            </div>
        </div>
    </div>

</div>
